<html>
<head>
<script src="../../http/tests/inspector/inspector-test.js"></script>
<script src="../../http/tests/inspector/console-test.js"></script>
<script src="resources/log-source.js"></script>
<script>
// Create a mix of log messages from different source files
function onload()
{
   console.info("sample info");
   console.log("sample log");
   console.warn("sample warning");
   console.debug("sample debug");
   console.error("sample error");
   
   console.info("abc info");
   console.info("def info");
   
   console.warn("abc warn");
   console.warn("def warn");
   
   runTest();
}
//# sourceURL=console-filter-level-test.html
</script>

<script>
function test()
{
    function dumpVisibleMessages()
    {
        var messages = Console.ConsoleView.instance()._visibleViewMessages;

        for (var i = 0; i < messages.length; i++)
            InspectorTest.addResult(">" + messages[i].toMessageElement().deepTextContent());
    }

    var testSuite = [
        function beforeFilter(next)
        {
            InspectorTest.addResult(arguments.callee.name);
            dumpVisibleMessages();
            next();
        },
        
        function onlyWarning(next)
        {
            Console.ConsoleView.instance()._filter._levelFilterUI._toggleTypeFilter("warning");
            dumpVisibleMessages();
            next();
        },
        
        function onlyInfo(next)
        {
            Console.ConsoleView.instance()._filter._levelFilterUI._toggleTypeFilter("info");
            dumpVisibleMessages();
            next();
        },
        
        function onlyErrorDebug(next)
        {
            Console.ConsoleView.instance()._filter._levelFilterUI._toggleTypeFilter("error");
            Console.ConsoleView.instance()._filter._levelFilterUI._toggleTypeFilter("verbose", true);
            dumpVisibleMessages();
            next();
        },
        
        function onlyAbcMessagePlain(next)
        {
            Console.ConsoleView.instance()._filter._levelFilterUI._toggleTypeFilter(UI.NamedBitSetFilterUI.ALL_TYPES);
            Console.ConsoleView.instance()._filter._textFilterUI.setValue("abc");
            dumpVisibleMessages();
            next();
        },
        
        function onlyAbcMessageRegex(next)
        {
            Console.ConsoleView.instance()._filter._textFilterUI._regexCheckBox.checked = "checked";
            Console.ConsoleView.instance()._filter._textFilterUI.setValue("ab[a-z]");
            dumpVisibleMessages();
            next();
        },
        
        function onlyAbcMessageRegexWarning(next)
        {
            Console.ConsoleView.instance()._filter._levelFilterUI._toggleTypeFilter("warning", false);
            dumpVisibleMessages();
            next();
        }
    ]

    InspectorTest.evaluateInConsole("'Should be always visible'", InspectorTest.runTestSuite.bind(InspectorTest, testSuite));
}

</script>
</head>

<body onload="onload()">
<p>
    Tests that console can filter messages by source.
</p>

</body>
</html>
